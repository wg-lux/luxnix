{ config, pkgs, lib, modulesPath, ... }:

{
  imports = [
    (modulesPath + "/installer/scan/not-detected.nix")
    ./boot-decryption-config.nix
    ./disks.nix
    ./luxnix.nix
  ];

  user = {
    admin = {
      name = "admin";
    };
    ansible.enable = true;
    settings.mutable = false;
  };

  roles = {
    {% for role in roles -%}
      {{ role.name }}.enable = true;
    {% endfor -%}
  };

  services = {
    {% for service in services -%}
      {{ service.name }}.enable = true;
    {% endfor -%}
  };
}